<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en"><head>

<title>Файловая структура Fallout 2</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- base href="http://teamx.ru/" -->
<style type="text/css">
</style>
</head><body>
<div class="section-1">
<div id="node-57" class="section-2">
<h1 class="book-heading">Файловая структура Fallout 2</h1>
<p>Описание файловой структуры Fallout 2.</p>
<p>Автор оригинальной версии документа: <b>Serge</b>, unDAT division (<a href="mailto:w_master@softhome.net">w_master@softhome.net</a>).
Авторы изменений: <b>Perceptron</b>, TeamX (<a href="mailto:perceptron@pisem.net">perceptron@pisem.net</a>), <b>Wasteland Ghost</b>, TeamX (<a href="mailto:wasteland_ghost@mail.ru">wasteland_ghost@mail.ru</a>).</p>
<p>В статье также использованы материалы исследований <b>Red!</b> (<a href="mailto:red_nnnno@hotmail.com">red_nnnno@hotmail.com</a>).</p>
<div id="node-58" class="section-3">
<h1 class="book-heading">1. Типы файлов</h1>
<table><tbody><tr><th>Тип</th><th>Комментарий</th></tr><tr><td><b>AAF</b></td><td> - шрифты.<br></td></tr><tr><td><b>ACM</b></td><td> - музыка, речь и спецэффекты.<br></td></tr><tr><td><b>BIO</b></td><td> - биографии стартовых персонажей.<br></td></tr><tr><td><b>CFG</b></td><td> - в master.dat\art\cuts\ это файлы настроек видеороликов, в директории игры это файл настроек игры (fallout2.cfg).<br></td></tr><tr><td><b>DAT</b></td><td>
- в директории игры это архивы с ресурсами, save.dat (в сохранёнках) -
данные сохранённой игры, worldmap.dat (см. ниже) - данные о карте мира.<br></td></tr><tr><td><b>FON</b></td><td> - немасштабируемые шрифты.<br></td></tr><tr><td><b>FRM</b></td><td> - картинки, могут быть анимированными. <b>FR0</b>, <b>FR1</b>, <b>FR2</b>, <b>FR3</b>, <b>FR4</b>, <b>FR5</b> - анимация существ в одном из шести направлений.<br></td></tr><tr><td><b>GAM</b></td><td> - файлы, содержащие информацию о переменных игры.</td></tr><tr><td><b>GCD</b></td><td> - содержат характеристики стартовых персонажей.</td></tr><tr><td><b>INT</b></td><td> - скомпилированные скрипты.</td></tr><tr><td><b>LIP</b></td><td> - файлы, необходимые для синхронизации озвучки и мимики "говорящих голов".</td></tr><tr><td><b>LST</b></td><td> - список файлов соответствующей директории, нужны для присвоения каждому файлу своего номера.</td></tr><tr><td><b>MAP</b></td><td> - карты местности.<br></td></tr><tr><td><b>MSG</b></td><td> - текстовые файлы.<br></td></tr><tr><td><b>MSK</b></td><td> - маски для карты мира.</td></tr><tr><td><b>MVE</b></td><td> - видеоролики.<br></td></tr><tr><td><b>PAL</b></td><td> - палитра.</td></tr><tr><td><b>PRO</b></td><td> - прототипы объектов игры.</td></tr><tr><td><b>RIX</b></td><td> - загрузочные картинки.</td></tr><tr><td><b>SAV</b></td><td> -  карты городов в сохраненных играх.<br></td></tr><tr><td><b>SVE</b></td><td> - субтитры для видеороликов.<br></td></tr><tr><td><b>TXT</b></td><td> - текстовые файлы со служебной информацией (формат каждого описан отдельно), либо просто текст.<br></td></tr></tbody></table></div>
<div id="node-59" class="section-3">
<h1 class="book-heading">2. Структура ресурсов игры</h1>
<p>Основные ресурсы игры располагаются в dat-файлах (архивах)
master.dat и critter.dat. Патч находится в архиве patchXXX.dat (см. п.
3). Сохранённые игры, изменённые файлы и музыка находятся в директории
...\FALLOUT2\DATA\. </p>
<p>Существует стандартная структура директорий, в которых игра ищет
свои файлы (она одинакова для master.dat, critter.dat, patchXXX.dat и
директории ...\FALLOUT2\DATA\):</p>
<ul>
    <b>\</b> - в корневой директории лежат шрифты и палитра игры.<br>
    <b>|</b><br>
    <b>+ART\</b> - в этой директории лежит графика игры - картинки, анимация, видео.<br>
<ul>
    <b>|</b><br>
    <b>+BACKGRND\</b> - картинки фона для "говорящих голов" - для различных локаций.<br>
    <b>+CRITTERS\</b> - анимация персонажей игры (см. в critter.dat).<br>
    <b>+CUTS\</b> - видеоролики.<br>
    <b>+HEADS\</b> - анимация для "говорящих голов".<br>
    <b>+INTRFACE\</b> - картинки интерфейса игры.<br>
    <b>+INVEN\</b> - картинки предметов в инвентаре.<br>
    <b>+ITEMS\</b> - картинки предметов на земле.<br>
    <b>+MISC\</b> - картинки "прочих" объектов.<br>
    <b>+SCENERY\</b> - картинки объектов окружения.<br>
    <b>+SKILLDEX\</b> - картинки характеристик (PIPboy).<br>
    <b>+SPLASH\</b> - загрузочные картинки.<br>
    <b>+TILES\</b> - тайлы пола и потолка зданий.<br>
    <b>+WALLS\</b> - стены зданий.<br>
</ul>
    <b>|</b><br>
    <b>+DATA\</b> - директория игровых данных.<br>
    <b>+MAPS\</b> - карты местности.<br>
    <b>+PREMADE\</b> - файлы, описывающие стандартных стартовых персонажей игры.<br>
    <b>+PROTO\</b> - прототипы (профили) следующих объектов игры:<br>
<ul>
    <b>|</b><br>
    <b>+CRITTERS\</b> - существа.<br>
    <b>+ITEMS\</b> - предметы.<br>
    <b>+MISC\</b> - "прочие" объекты.<br>
    <b>+SCENERY\</b> - объекты окружения.<br>
    <b>+TILES\</b> - плитки (тайлы) пола и потолка.<br>
    <b>+WALLS\</b> - стены.<br>
</ul>
    <b>|</b><br>
    <b>+SCRIPTS\</b> - скомпилированные скрипты.<br>
    <b>+SOUND\</b> - речь и спецэффекты.<br>
<ul>
    <b>|</b><br>
    <b>+SFX\</b> - спецэффекты (звуки предметов, оружия и т.д.).<br>
    <b>+SPEECH\</b> - речь "говорящих голов".<br>
<ul>
    <b>|</b><br>
    <b>+BOSSS\</b> - Френк Хорриган.<br>
    <b>+ELDER\</b> - Старейшина.<br>
    <b>+HAKU2\</b> - Хакунин (умирающий).<br>
    <b>+HAKUN\</b> - Хакунин.<br>
    <b>+HRLD2\</b> - Гарольд.<br>
    <b>+LYNET\</b> - Линетт.<br>
    <b>+MRCUS\</b> - Маркус.<br>
    <b>+MYRON\</b> - Майрон.<br>
    <b>+NARRATOR\</b> - Рассказчик.<br>
    <b>+POWER\</b> - Анклавовец.<br>
    <b>+PRESI\</b> - Президент.<br>
    <b>+SULIK\</b> - Сулик.<br>
    <b>+TNDI2\</b> - Танди.<br>
</ul>
</ul>
    <b>|</b><br>
    <b>+TEXT\ENGLISH\</b> - текстовые файлы (файлы сообщений).<br>
<ul>
    <b>|</b><br>
    <b>+CUTS\</b> - субтитры для видеороликов.<br>
    <b>+DIALOG\</b> - диалоги и сообщения.<br>
    <b>+GAME\</b> - текст, относящийся к интерфейсу игры.
</ul>
</ul>
<p><b>Примечания:</b></p>
<p>Пути к музыке указываются отдельно в fallout2.cfg (она не хранится в DAT-файлах).
К файлам игры также относится worldmap.dat, который игра создаёт сама и записывает в первый доступный корень (см. п. 3).</p>
<p>Cохранёнки игра кладет в [master_patches]\SAVEGAME\SLOTXX, где XX -
номер слота (01 - 10). В слотах лежат файлы SAV, файл SAVE.DAT, файл
AUTOMAP.SAV и в папках proto\items\, proto\critters\ лежат файлы PRO.</p></div>
<div id="node-60" class="section-3">
<h1 class="book-heading">3. Порядок загрузки файлов игрой</h1>
<p><b>Замечание:</b> пути к ресурсам указываются в файле fallout2.cfg.</p>
<p>Игра загружает свои файлы в следующем порядке (из исследований Red'а):</p>
<ul>
    <b>0.</b> SAVEGAME (сохранённые игры, обычно лежат в ..\FALLOUT2\DATA\)<br>
    <b>1.</b> patchXXX.dat (файл патча)<br>
    <b>2.</b> critter_patches (обычно это ..\FALLOUT2\DATA\)<br>
    <b>3.</b> critter_dat (обычно это ..\FALLOUT2\DATA\critter.dat)<br>
    <b>4.</b> master_patches (обычно это ..\FALLOUT2\DATA\)<br>
    <b>5.</b> master_dat (обычно это ..\FALLOUT2\DATA\master.dat)<br>
    <b>6.</b> текущая директория (обычно это директория игры, т.е. ..\FALLOUT2\)<br>
    <b>7.</b> если найти данные не получилось, движок пытается продолжить без них - настолько изящно, насколько может.
</ul>
<p>Обратите внимание на очень важный факт, следующий из этого списка:
если вы грузите сохранённую игру, то в первую очередь файлы берутся
именно из неё! Затем из patchXXX.dat и только затем из директории DATA.
Поскольку изменённые в процессе моддинга файлы обычно сохраняются
именно в директории DATA, чтобы увидеть свои изменения, вам скорее
всего придётся, во-первых, начать новую игру, а во-вторых - избавиться
от patchXXX.dat, например, распаковав его предварительно в ту же
директорию DATA. Подробнее о подготовке Fallout2 к моддингу можно
узнать из FAQ.</p>
<p>Название patchXXX.dat означает, что движок на самом деле ищет в
текущей директории файлы с именами от patch000.dat до patch998.dat с
шагом 2, т.е. только с чётными номерами - patch000.dat, patch0002.dat,
..., patch998.dat. Посте того, как первый файл обнаружен, движок
останавливается и последующие патчи уже не ищет.</p>
<p>Запомните, чтобы вы могли сохраняться, <b>critter_patches и master_patches должны указывать на одну и ту же директорию!</b></p>
<p>Еще одна неприятная особенность игры заключается в том, что <b>игра удаляет все [master_patches]\proto\items\*.pro и [master_patches]\proto\critters\*.pro!</b>
Решение этой проблемы, а также подробности о работе движка с ресурсами
и способы оптимизации их загрузки, можно узнать из исследований Red'а
"Как движок Fallout2 ищет свои ресурсы".</p></div>
</div>
</div>

</body></html>